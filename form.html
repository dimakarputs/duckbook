<!DOCTYPE HTML>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>DuckBook</title>
    <link rel="stylesheet" href="form.style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="localiz.js"></script>
    <script src="JQiery.js"></script>
    <link rel="shortcut icon" href="foto/favicon.ico" type="image/x-icon">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Mono&display=swap');
    </style>
</head>
<body>
    <div class="superContainer">
        <!-- HEADER -->
        <header>
            <div class="wrap">
                <a href="Untitled-1.html" class="big_name" id="site-name">DuckBook</a>
                <ul class="menuBlock">
                    <li><a href="Magazin.html" id="shops-link">МАГАЗИНЫ</a></li>
                    <li><a href="form.html" id="login-link">ВОЙТИ</a></li>
                    <button class="menu-button">
                        <a href="form.html"><img src="foto/profile.png" alt="Профиль" class="profile-icon"></a>
                    </button>
                </ul>
                <div class="hamburger-menu">
                    <input id="menu__toggle" type="checkbox" />
                    <label class="menu__btn" for="menu__toggle">
                        <span></span>
                    </label>
                    <ul class="menu__box">
                        <li><a class="menu__item" href="Magazin.html">МАГАЗИНЫ</a></li>
                        <li><a class="menu__item" href="form.html">ВОЙТИ</a></li>
                        <li><a class="menu__item" href="form.html">Профиль</a></li>
                    </ul>
                </div>
            </div>
        </header>

        <!-- Основная форма -->
        <div class="wrap" id="wrapForm">
            <div class="items_head">
                <p class="items_name" id="login-form-title">Вход</p>
            </div>
            <form id="loginForm">
                <ul>
                    <li>
                        <label for="user_name" id="user-name-label">Имя пользователя</label>
                        <input type="text" id="user_name" name="user_name" />
                    </li>
                    <li>
                        <label for="user_password" id="password-label">Пароль</label>
                        <input type="password" id="user_password" name="user_password" />
                    </li>
                    <li class="button">
                        <button type="button" style="color:rgb(252, 250, 250);" id="login-button">Войти</button>
                    </li>
                    <li class="button">
                        <button id="butt">
                            <a href="profile.html" style="color:rgb(252, 250, 250);" id="register-button">Регистрация</a>
                        </button>
                    </li>
                </ul>
            </form>
        </div>

        <!-- Футер -->
        <footer class="full-footer">
            <div class="footer">
              <div class="content">
                <div class="logo-footer">
                  <a href="#logo" class="logo-up">
                    <img src="foto\duckbook2.png">
                  </a>
                  <div class="footer-info">
                    <div class="soc-media">
                      <a class="soc-net" href="https://www.youtube.com/channel/UCXi2IeP2M-Z6Vsi-eNeGxAA"><img src="foto\youtube.png"></a>
                      <a class="soc-net" href="https://discord.gg/U8QzVpVnDE"><img src="foto\steam.png"></a>
                      <a class="soc-net" href="https://vk.com/public212916411"><img src="foto\vk.png"></a>
                      <a class="soc-net" href="https://www.twitch.tv/gi_twich"><img src="foto\twitch.png"></a>
                      <a class="soc-net" href="https://t.me/+UA9zMUjTAX9jZDg6"><img src="foto\telegram.png"></a>
                    </div>
                    <div class="footer-description">
                      <div class="company-info">
                        <p id="our-stores-title">Наши магазины</p>
                        <ul>
                          <li id="store-kamenaya">Ст. метро "Каменная горка"</li>
                          <li id="store-pushkinskaya">Ст. метро "Пушкинская"</li>
                          <li id="store-nemiga">Ст. метро "Немига"</li>
                        </ul>
                      </div>
                      <div class="contacts">
                        <p id="phone-number">+375482344565</p>
                        <p id="email">BOOKTOK@gmail.com</p>
                        <p id="company-name"> DuckBook</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </footer>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Проверка, если пользователь уже авторизован (например, проверяем localStorage)
            if (localStorage.getItem("userLoggedIn") === "true") {
                window.location.href = 'kabinet.html'; // Если пользователь авторизован, перенаправляем на кабинет
            }

            // Обработчик нажатия на кнопку "Войти"
            document.getElementById("login-button").addEventListener("click", function(event) {
                event.preventDefault(); // Предотвращаем перезагрузку страницы

                const userName = document.getElementById("user_name").value;
                const userPassword = document.getElementById("user_password").value;

                // Проверка на пустые поля
                if (!userName || !userPassword) {
                    alert("Пожалуйста, введите имя пользователя и пароль.");
                    return;
                }

                const loginData = {
                    user_name: userName,
                    user_password: userPassword
                };

                // Отправка данных на сервер через fetch API
                fetch('http://192.168.201.1:9999/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(loginData)
                })
                .then(response => response.json()) // Преобразуем ответ в JSON
                .then(data => {
                    if (data.status === 'success') {
                        // Сохраняем данные пользователя в localStorage (можно заменить на cookies)
                        localStorage.setItem("userLoggedIn", "true");
                        localStorage.setItem("userName", userName);

                        // Перенаправляем на страницу пользователя (кабинет)
                        window.location.href = 'kabinet.html';
                    } else {
                        // Показываем ошибку
                        alert("Неверное имя пользователя или пароль.");
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Произошла ошибка при отправке запроса. Попробуйте еще раз.');
                });
            });
        });
    </script>
</body>
</html>
